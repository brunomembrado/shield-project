// Prisma schema for Shield Wallet Service
// This service manages user cryptocurrency wallet addresses

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["shield_wallets"]
}

/// Chain types supported by Shield platform
enum ChainType {
  POLYGON  // Polygon (MATIC) network
  TRON     // Tron network

  @@schema("shield_wallets")
}

/// Wallet model represents a cryptocurrency wallet address owned by a user
/// Users can have multiple wallets across different chains
model Wallet {
  /// Unique identifier (UUID v4)
  id       String    @id @default(uuid())
  
  /// Foreign key to User (from auth-service)
  /// This is the user ID from the auth service database
  userId   String    @map("user_id")
  
  /// Optional label/tag for the wallet (e.g., "Main Wallet", "Business Account")
  tag      String?
  
  /// Blockchain network (POLYGON or TRON)
  chain    ChainType
  
  /// Wallet address on the blockchain
  /// - Polygon: 0x... format (40 hex chars)
  /// - Tron: T... format (34 chars)
  address  String
  
  /// Whether this wallet is active and can be used for transactions
  isActive Boolean   @default(true) @map("is_active")
  
  /// ENCRYPTED PRIVATE KEY STORAGE (only for system-generated wallets)
  /// AES-256-GCM encrypted private key (null for user-imported wallets)
  privateKeyEncrypted String? @map("private_key_encrypted")
  
  /// Initialization vector used for AES-256-GCM encryption
  encryptionIv        String? @map("encryption_iv")
  
  /// Salt used for PBKDF2 key derivation from user password
  encryptionSalt      String? @map("encryption_salt")
  
  /// Flag indicating if this wallet was generated by our system (true) or imported by user (false)
  /// If true, modifying/deleting requires password verification
  createdBySystem     Boolean @default(false) @map("created_by_system")
  
  /// Timestamp when wallet was added
  createdAt DateTime @default(now()) @map("created_at")
  
  /// Timestamp when wallet was last updated
  updatedAt DateTime @updatedAt @map("updated_at")

  @@schema("shield_wallets")
  @@map("wallets")
  @@index([userId])
  @@index([address])
  @@index([chain])
  @@index([createdBySystem])
  @@unique([userId, address]) // User cannot add the same address twice
}

