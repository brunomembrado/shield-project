// Prisma schema for Shield Compliance Service
// This service handles KYB/KYC verification and transaction screening

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// Compliance check status
enum ComplianceStatus {
  PENDING           // Check initiated
  APPROVED          // Check passed
  REJECTED          // Check failed
  REVIEW_REQUIRED   // Manual review needed
}

/// Risk level assessment
enum RiskLevel {
  LOW       // Low risk
  MEDIUM    // Medium risk
  HIGH      // High risk
  CRITICAL  // Critical risk
}

/// Entity type for compliance checks
enum EntityType {
  USER        // User verification (KYC)
  BUSINESS    // Business verification (KYB)
  TRANSACTION // Transaction screening
  WALLET      // Wallet address screening
}

/// ComplianceCheck model stores compliance verification results
model ComplianceCheck {
  /// Unique identifier (UUID v4)
  id String @id @default(uuid())
  
  /// Entity type being checked
  entityType EntityType @map("entity_type")
  
  /// ID of the entity being checked (user ID, transaction ID, etc.)
  entityId String @map("entity_id")
  
  /// Compliance check status
  status ComplianceStatus
  
  /// Risk level assessment
  riskLevel RiskLevel @map("risk_level")
  
  /// Type of check (KYC, KYB, AML, Sanctions, etc.)
  checkType String @map("check_type")
  
  /// Additional check details (JSON)
  details Json?
  
  /// Review notes (for manual review)
  reviewNotes String? @map("review_notes")
  
  /// ID of reviewer (if manually reviewed)
  reviewedBy String? @map("reviewed_by")
  
  /// Timestamp when check was created
  createdAt DateTime @default(now()) @map("created_at")
  
  /// Timestamp when check was last updated
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("compliance_checks")
  @@index([entityType, entityId])
  @@index([status])
  @@index([riskLevel])
  @@index([checkType])
  @@index([createdAt])
}

